<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Content AI</title>
    <meta name="viewport" content="width = device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>

<body style="background-image: url('image/AI background.svg');">
<div class = "wrapper">
    <div class="title">Content AI</div>
    <div id="form" class="form">
        <div class="bot-inbox inbox">
            <div class="icon">
                <i class="fas fa-user"></i>
            </div>
            <div class="msg-header">
                <p>Nice to meet you today!<br>
                    Please paste your content below</p>
            </div>
        </div>
    </div>
    <div class="typing-field">
        <div class="input-data">
            <textarea id="data" placeholder="Type something ..." required type="text"></textarea>
            <button id="send-btn">Send</button>
        </div>
    </div>
</div>
</div>

<script>

    $(document).ready(function(){
        $("#send-btn").on("click", function(){
            send_message()
        });
    });

    $(document).keypress(function (event) {
        var keycode = (event.keyCode ? event.keyCode : event.which);
        if (keycode == 13 && !event.shiftKey) { // "Enter" keycode and shift key not pressed
            event.preventDefault(); // prevent default "enter" action
            send_message();
        }
    });

    function send_message() {
        let value = $("#data").val();
        let msg = '<div class="user-inbox inbox"><div class="msg-header"><p>' + nl2br(value) + '</p></div></div>';
        $("#form").append(msg);
        // when chat goes down the scroll bar automatically comes to the bottom
        $("#form").scrollTop($("#form")[0].scrollHeight);
        $("#data").val('');

        // Add waiting message
        let waitMsg = '<div class="bot-inbox inbox waiting-msg"><div class="icon"><i class="fas fa-user"></i></div><div class="msg-header"><p class="pulse">Working on it. . .</p></div></div>';
        $(".form").append(waitMsg);

        // Send the user's message to the backend for processing
        // start ajax code
        $.ajax({
            url: 'text.php',
            type: 'POST',
            data: 'text=' + value,
            success: function (result) {
                // Remove waiting message
                $(".waiting-msg").remove();

                let replay = '<div class="bot-inbox inbox"><div class="icon"><i class="fas fa-user"></i></div><div class="msg-header"><p>Rewritten content is ready for review.</p><p>' + nl2br(result) + '</p></div></div>';
                $("#form").append(replay);
                // when chat goes down the scroll bar automatically comes to the bottom
                $("#form").scrollTop($("#form")[0].scrollHeight);
            }
        });
    }

    function nl2br(str) {
        return str.replace(/(?:\r\n|\r|\n)/g, '<br>');
    }
</script>


</body>
</html>